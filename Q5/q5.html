<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Population Growth</title>
    <link rel="stylesheet" href="q5.css">
    <script src="../lib/d3.v3.min.js"></script>
    <script src="../lib/d3-queue.v3.min.js"></script>
    <script src="../lib/d3.tip.v0.6.3.js"></script>
  </head>
  <body>
    <script>
    var dataset = [
    	{city: 'San Antonio', population_2012: 1383505, growth: {year_2013:25405, year_2014:26644 , year_2015:28593 , year_2016:23591 , year_2017:24208}},
    	{city: 'New York', population_2012: 8383504, growth: {year_2013:75138 , year_2014:62493 , year_2015:61324 , year_2016:32967 , year_2017:7272}},
    	{city: 'Chicago', population_2012: 2717989, growth: {year_2013:6493 , year_2014:2051 , year_2015:-1379 , year_2016:-4879 , year_2017:-3825}},
    	{city: 'Los Angeles', population_2012: 3859267, growth:{year_2013:32516 , year_2014:30885 , year_2015:30791 , year_2016:27657 , year_2017:18643}},
    	{city: 'Phoenix', population_2012: 1495880, growth: {year_2013:25302 , year_2014:26547 , year_2015:27310 , year_2016:27003 , year_2017:24036}}
    ];
    var sumDataset = [];
    dataset.forEach(function(entry, i){
    	sumDataset[i] = { city: entry.city, total_population: entry.population_2012 + entry.growth.year_2013 + entry.growth.year_2014 + entry.growth.year_2015 + entry.growth.year_2016 + entry.growth.year_2017}

    })

    sumDataset.sort(function(a, b) {
        return b.total_population - a.total_population;
      });

    var w = 800;
    var h = 450;
    var margin = {
    	top: 20,
    	bottom: 40,
    	left: 100,
    	right: 20
    };
    var width = w - margin.left - margin.right;
    var height = h - margin.top - margin.bottom;
    var x = d3.scale.linear()
    		.domain([0, d3.max(sumDataset, function(d){
    			return d.total_population;
    		})])
    		.range([0, width]);
    var y = d3.scale.ordinal()
    		.domain(sumDataset.map(function(entry){
    			return entry.city;
    		}))
    		.rangeBands([0, height]);
    var ordinalColorScale = d3.scale.category20();
    var xAxis = d3.svg.axis()
    			.scale(x)
    			.orient("bottom");
    var yAxis = d3.svg.axis()
    			.scale(y)
    			.orient("left");
    var svg = d3.select("body").append("svg")
    			.attr("id", "chart")
    			.attr("width", w)
    			.attr("height", h);
    var chart = svg.append("g")
    			.classed("display", true)
    			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    function plot(params){
    	this.selectAll(".bar")
    		.data(params.data)
    		.enter()
    			.append("rect")
    			.classed("bar", true)
    			.attr("x", 0)
    			.attr("y", function(d,i){
    				return y(d.city);
    			})
    			.attr("height", function(d,i){
    				return y.rangeBand()-1;
    			})
    			.attr("width", function(d){
    				return x(d.total_population);
    			})
    			.style("fill", "purple")
          .on("mouseover", function(d){
            d3.select(this)
              .style("fill", "red");
          })
          .on("mouseout", function(d) {
            d3.select(this)
              .transition()
              .duration(250)
              .style("fill", function(d) {
                 return "purple";
               })
            });
    	this.selectAll(".bar-label")
    		.data(params.data)
    		.enter()
    			.append("text")
    			.classed("bar-label", true)
    			.attr("x", 0)
    			.attr("dx", 4)
    			.attr("y", function(d,i){
    				return y(d.city);
    			})
    			.attr("dy", function(d,i){
    				return y.rangeBand()/1.7;
    			})
    			.text(function(d){
    				return d.total_population;
    			})

    	this.append("g")
    		.classed("y axis", true)
    		.attr("transform", "translate(0,0)")
    		.call(yAxis);
    }
    plot.call(chart, {data: sumDataset});
    </script>
    </body>
    </html>
